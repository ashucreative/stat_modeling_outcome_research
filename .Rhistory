#install.packages("survsim")
library(survsim)
N=100 #number of patients
set.seed(123)
df.tf<-simple.surv.sim(#baseline time fixed
n=N, foltime=500,
dist.ev=c('llogistic'),
anc.ev=c(0.68), beta0.ev=c(5.8),
anc.cens=1.2,
beta0.cens=7.4,
z=list(c("unif", 0.8, 1.2)),
beta=list(c(-0.4),c(0)),
x=list(c("bern", 0.5),
c("normal", 70, 13)))
names(df.tf)[c(1,6,7)]<-c("id","grp","age")
View(df.tf)
?simple.surv.sim
set.seed(123)
nft<-sample(1:10,
N,replace=T)#number of follow up time points
crp<-round(abs(rnorm(sum(nft)+N,
mean=100,sd=40)),1)
time<-NA
id<-NA
i=0
for(n in nft){
i=i+1
time.n<-sample(1:500,n)
time.n<-c(0,sort(time.n))
time<-c(time,time.n)
id.n<-rep(i,n+1)
id<-c(id,id.n)
}
df.td <- cbind(data.frame(id,time)[-1,],crp)
View(df.td)
df<-tmerge(df.tf,df.tf,id=id,
endpt=event(stop,status))
library(survival)
df<-tmerge(df.tf,df.tf,id=id,
endpt=event(stop,status))
View(df)
head(round(df))
# split into the simulated time intervals
df <- tmerge(df,df.td,id=id,
crp=tdc(time,crp))
# split into the simulated time intervals
df <- tmerge(df,df.td,id=id,
crp=tdc(time,crp))
head(round(df),10)
View(df)
# Fit Cox model
fit.tdc <- coxph(Surv(tstart,tstop,endpt)~
grp+age+crp+cluster(id),df)
fit.tdc
# CPH with time-varying coefficients
fit2 <- coxph(Surv(time, status) ~
age +ph.karno+sex,
data=lung)
zph <- cox.zph(fit2)
zph
plot(zph[2],lwd=2)
abline(0,0, col=1,lty=3,lwd=2)
abline(h= fit2$coef[2], col=3, lwd=2, lty=2)
legend("bottomright",
legend=c('Reference line for null effect',
"Average hazard over time",
"Time-varying hazard"),
lty=c(3,2,1), col=c(1,3,1), lwd=2)
lung.split <- survSplit(Surv(time, status) ~ .,
data= lung, cut=c(180, 350),
episode= "tgroup", id="id")
head(lung.split[-c(1,4,6:8)])
View(zph)
View(lung.split)
fit.split <- coxph(Surv(tstart, time, status) ~
age + ph.karno:strata(tgroup)+
sex,
data=lung.split)
fit.split
# check assumption
cox.zph(fit.split)
# User-defined parametric continuous function to describe the time-varying coefficient
fit.tt <- coxph(Surv(time, status) ~
age + ph.karno + tt(ph.karno)+ sex,
data=lung,
tt = function(x, t, ...) x * log(t+20))
fit.tt
# Coefficients for both the ph.karno and tt(ph.karno) are significant, implying effect of ph.karno varies with time.
# Plot results
zph.tt <- cox.zph(fit2,
transform=function(t) log(t+20))
plot(zph.tt[2])
abline(coef(fit.tt)[2:3], col=2)
library(timereg)
# Investigating time-varying coefficient with timereg package
install.packages(timereg)
# Investigating time-varying coefficient with timereg package
install.packages("timereg")
library(timereg)
fit.out <- timecox(Surv(time,status)~
age+sex+ph.karno,
data=lung,n.sim=500,
max.time=700)
summary(fit.out)
par(mfrow=c(2,2))
plot(fit.out)
fit.const <- timecox(Surv(time,status)~
const(age)+const(sex)+ph.karno,
data=lung,n.sim=500,
max.time=700)
coef(fit.const)
